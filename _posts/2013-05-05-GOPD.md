---
layout: post
title: 普通科診所地圖
desc: 醫院管理局的普通科門診資料，包括地址、電話、診症時間等。
level: 第二級
img: pic01.jpg
tags: [醫療服務地圖]
---
<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>
<script src="https://cdn.klokantech.com/mapbox-gl-js/v0.43.0/mapbox-gl.js"></script>
<script src="https://cdn.klokantech.com/mapbox-gl-leaflet/latest/leaflet-mapbox-gl.js"></script>
 
<div id="map_canvas"></div>
 
 
<script type="text/javascript"> 
   var openPopup = null;
   var MyCustomMarker = L.Marker.extend({
 
    bindPopup: function(htmlContent, options) {
	  			
		if (options && options.showOnMouseOver) {
			
			// call the super method
			L.Marker.prototype.bindPopup.apply(this, [htmlContent, options]);
			
			// unbind the click event
			this.off("click", this.openPopup, this);
			
			// bind to mouse over
			this.on("mouseover", function(e) {
				
				// get the element that the mouse hovered onto
				var target = e.originalEvent.fromElement || e.originalEvent.relatedTarget;
				var parent = this._getParent(target, "leaflet-popup");
 
				// check to see if the element is a popup, and if it is this marker's popup
				if (parent == this._popup._container)
					return true;
				
				if (openPopup){
				    openPopup.closePopup();
				    openPopup = null;
				}
				// show the popup
				this.openPopup();
				openPopup = this;
				
			}, this);
			
			// and mouse out
			this.on("mouseout", function(e) {
				
				// get the element that the mouse hovered onto
				var target = e.originalEvent.toElement || e.originalEvent.relatedTarget;
				
				// check to see if the element is a popup
				if (this._getParent(target, "leaflet-popup")) {
 
					L.DomEvent.on(this._popup._container, "mouseout", this._popupMouseOut, this);
					return true;
 
				}
				
				// hide the popup
				// this.closePopup();
				
			}, this);
			
		}
		
	},
 
	_popupMouseOut: function(e) {
	    
		// detach the event
		L.DomEvent.off(this._popup, "mouseout", this._popupMouseOut, this);
 
		// get the element that the mouse hovered onto
		var target = e.toElement || e.relatedTarget;
		
		// check to see if the element is a popup
		if (this._getParent(target, "leaflet-popup"))
			return true;
		
		// check to see if the marker was hovered back onto
		if (target == this._icon)
			return true;
		
		// hide the popup
		this.closePopup();
		
	},
	
	_getParent: function(element, className) {
		
		var parent = element.parentNode;
		
		while (parent != null) {
			
			if (parent.className && L.DomUtil.hasClass(parent, className))
				return parent;
			
			parent = parent.parentNode;
			
		}
		
		return false;
		
	}
 
});
   var mapDiv = document.getElementById('map_canvas');
   var viewport = document.querySelector("meta[name=viewport]");
   viewport.setAttribute('content', 'initial-scale=1.0, user-scalable=no');
   mapDiv.style.width = '100%';
   mapDiv.style.height = '500px';
 
   var mymap = L.map('map_canvas').setView([22.38269281766774, 114.10987863448963], 11);
   mymap.setMaxBounds(mymap.getBounds());
   
   var gl = L.mapboxGL({
     attribution: '<a href="https://www.maptiler.com/license/maps/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>',
     accessToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',
     style: 'https://maps.tilehosting.com/c/c2392ad1-e959-404a-b55d-5f0da0f052fb/styles/OPENMEDICSHK/style.json?key=vrdEIAaBrAhTaX6Y5X2r'
   }).addTo(mymap);
   
   var data = {{ site.data.GOPCINFO | jsonify }};
   var markers = new L.FeatureGroup();
   for (i in data){
      if (i == 0) continue;
      
      var lat = data[i][9],
      	  long = data[i][10],
	  nameTC = data[i][4],
	  addressTC = data[i][5];      
      
      var marker = new MyCustomMarker(new L.LatLng(lat, long));
        marker.bindPopup(
		'<strong>'+nameTC+'</strong><br>'+
		addressTC+'<br><a href="https://citymapper.com/directions?endcoord='+lat+'%2C'+long+'&endname='+nameTC+'&endaddress='+addressTC+' target='_blank' rel='noopener noreferrer' ">如何前往？</a>', 
	  { showOnMouseOver: true });
       markers.addLayer(marker);
   }
   mymap.addLayer(markers);
</script>
